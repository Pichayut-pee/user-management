<link href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round" rel="stylesheet">
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">  <!-- Link to your CSS file -->
    <link rel="stylesheet" href="{% static '/font-awesome/css/font-awesome.min.css' %}">
</head>
<body>

        <div id="overlay"></div>
        <div class="screen_user_setting">

                {% block message %}
                {% if error_message %}
                    <div class="toast_error_message">
                        {{ error_message }}
                    </div>
                {% endif %}
                {% endblock %}
                <form class="user_settings" id=user_condo_favorite">

                  <label for="user_favorite_location">  <i class="button__icon fa fa-map-o"></i> เลือกคอนโด</label>
                    <select name="user_favorite_location" id="user_favorite_location">
                      <option value="พลัม_แจ้งวัฒนะ_สเตชั่น">พลัม แจ้งวัฒนะ สเตชั่น</option>
                      <option value="ดีคอนโด_จรัญ_บางขุนนนท์">ดีคอนโด จรัญ บางขุนนนท์</option>
                      <option value="ดีคอนโด_รามอินทรา">ดีคอนโด รามอินทรา</option>
                      <option value="ดีคอนโด_รามอินทรา">ดีคอนโด รามอินทรา</option>
                      <option value="รีเจ้นท์ โฮม 18">รีเจ้นท์ โฮม 18</option>
                      <option value="รีเจ้นท์ โฮม 15">รีเจ้นท์ โฮม 15</option>
                    </select>
                    <div class="text__field">
                        <label for="user_favorite_space_from"><i class="button__icon fa fa-home"></i> ขนาดห้องที่ต้องการ (ตร.ม.)</label>
                        <input  name="user_favorite_space_from"  type="number" id="user_favorite_space_from" class="txt__input" value="0" min="0">
                        <span class="focus-border"></span>
                        <label class="txt__center_label"> ถึง </label>
                        <input  name="user_favorite_space_to"  type="number"   id="user_favorite_space_to" class="txt__input" value="99" min="0">
                        <span class="focus-border"></span>
                    </div>
                    <div class="text__field">
                        <label for="user_favorite_price_from"><i class="button__icon fa fa-money"></i> ช่วงราคาที่ต้องการ (บาท)</label>
                        <input  name="user_favorite_price_from" type="text" id="user_favorite_price_from" class="txt__input" value="0" min="900000" onblur="numberWithCommas('user_favorite_price_from')">
                        <span class="focus-border"></span>
                        <label class="txt__center_label"> ถึง </label>
                        <input  name="user_favorite_price_to" type="text" id="user_favorite_price_to" class="txt__input" value="10,000,000" min="900000">
                    </div>
                   <div class="text__field">
                        <label for="user_favorite_floor_from"><i class="button__icon fa fa-building"></i> ชั้นที่ต้องการ </label>
                        <input  name="user_favorite_floor_from" type="number" id="user_favorite_floor_from" class="txt__input" value="0" min="0">
                        <span class="focus-border"></span>
                        <label class="txt__center_label"> ถึง </label>
                        <input  name="user_favorite_floor_to" type="number" id="user_favorite_floor_to" class="txt__input" value="99" min="99">
                    </div>
                    <div id="error_msg" hidden="hidden" class="error-message"></div>
                    <button type="Button" class="button__submit form__submit" onclick="save_search_favorite()">
                        <span class="button__text">Save</span>
                        <i class="button__icon fa fa-chevron-right"></i>
                    </button>
                </form>

    </div>
     <div class="popup">

        <span class="popuptext" id="myPopup">
            <div class="checkmark"></div>
            Your favorite has been saved
            <button type="Button" class="button__width_30"  onclick="off_overlay()" >OK</button>

        </span>
    </div>
</body>
</html>
<script type="text/javascript">
    function off_overlay() {
        document.getElementById("overlay").style.display = "none";
        let popup = document.getElementById("myPopup");
        popup.classList.remove("show")
    }
    async function numberWithCommas(id) {
        const number = document.getElementById(id).value
        const formattedNumber =  number.toString().replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ",")
        document.getElementById(id).value = formattedNumber
    }

    async function save_search_favorite(){
        const user_favorite_location = document.getElementById("user_favorite_location").value
        const user_favorite_space_from = document.getElementById("user_favorite_space_from").value
        const user_favorite_space_to = document.getElementById("user_favorite_space_to").value
        const user_favorite_price_from = document.getElementById("user_favorite_price_from").value
        const user_favorite_price_to = document.getElementById("user_favorite_price_to").value
        const user_favorite_floor_from = document.getElementById("user_favorite_floor_from").value
        const user_favorite_floor_to = document.getElementById("user_favorite_floor_to").value

        let access_token = localStorage.getItem("access_token")
        if(!access_token){
            console.log("Error: No auth object found")
        }
        const data = {
            location: user_favorite_location,
            space_from: user_favorite_space_from,
            space_to: user_favorite_space_to,
            price_from: user_favorite_price_from,
            price_to: user_favorite_price_to,
            floor_from: user_favorite_floor_from,
            floor_to: user_favorite_floor_to

           }
            const apiUrl = '/create/favorite_search';
            const requestOptions = {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'Authorization':'Bearer '+access_token,
              },
              body: JSON.stringify(data),
            }

        try{
            const response = await  fetch(apiUrl, requestOptions)
            if(!response.ok){
                console.error(response)
                document.getElementById("error_msg").innerHTML = "Unexpected error";
                document.getElementById('error_msg').hidden = false
                return;
            }
            let popup = document.getElementById("myPopup");
            popup.classList.toggle("show");
            document.getElementById("overlay").style.display = "block";
            

        }catch (error){
            console.error(error)
            document.getElementById("error_msg").innerHTML = "Unexpected error";
            document.getElementById('error_msg').hidden = false
        }
    }



</script>
